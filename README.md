# Hubster Application

A mobile application for discovering, hosting, and managing shared subscriptions. Built with Flutter for the frontend and Go (Golang) for the backend.

## Features

- **User Authentication:** Secure user sign-up, login, and profile management using JWT.
- **Subscription Hosting:** Users can offer their existing subscriptions for sharing with others.
- **Subscription Discovery:** Members can explore and find available shared subscriptions.
- **Joining Mechanism:** Members can request to join subscriptions, and hosts can approve or decline these requests.
- **Payment Proof System:** Members can submit proof of payment for their slots, and hosts can verify these proofs.
- **Image Uploads:** Functionality for uploading QR codes (for hosts) and payment receipts (for members), stored securely in Google Cloud Storage.
- **API Documentation:** Interactive API documentation available via Swagger UI.

## Tech Stack

- **Frontend (Mobile - Hubster App):**
  - **Framework:** Flutter
  - **Language:** Dart
  - **State Management:** Riverpod
  - **Dependency Injection:** GetIt with Injectable
  - **Navigation:** Flutter Navigator (with named routes)
  - **Local Storage:** `shared_preferences` (for auth token)
  - **UI Components:** Material Design
- **Backend:**
  - **Language:** Go (Golang)
  - **Framework:** Fiber
  - **Database:** PostgreSQL (via Docker Compose)
  - **ORM:** GORM
  - **Authentication:** JWT (JSON Web Tokens) using `golang-jwt/jwt/v5`
  - **Configuration:** Viper & GoDotEnv
  - **Password Hashing:** Bcrypt
  - **Image Storage:** Google Cloud Storage (GCS)
  - **API Documentation:** Swaggo (Swagger API Documentation)
  - **Live Reloading (Dev):** Air
- **Database Management:**
  - PgAdmin (via Docker Compose)
- **Containerization:**
  - Docker & Docker Compose (for Database & PgAdmin)

## API Documentation

Once the backend server is running, interactive API documentation (generated by Swaggo) is available via Swagger UI at:

`http://localhost:8080/swagger/index.html`

This interface allows you to explore and interact with the backend API endpoints. Remember to authorize using the JWT token obtained after login (use the "Authorize" button and enter `Bearer <your_token>`).

## Prerequisites

- **Flutter SDK** (latest stable version recommended)
- **Go** (version 1.20 or higher recommended)
- **Docker & Docker Compose**
- **Google Cloud Storage (GCS) Bucket and Service Account Key** (for image uploads)
- **Air** (Optional, for Go backend live reloading during development)
- An IDE like VS Code or Android Studio/IntelliJ IDEA for Flutter and Go development.

## Project Structure

The project contains two main parts:

- `backend/`: The Go Fiber application providing the API.
- `hubster_app/`: The Flutter mobile application.

## Installation Guide

1.  **Clone the repository:**

    ```bash
    git clone https://github.com/xNatthapol/Hubster.git
    ```

    Change directory to project directory

    ```bash
    cd Hubster
    ```

2.  **Backend Setup:**

    - Navigate to the backend directory:
      ```bash
      cd backend
      ```
    - **Create Environment File (`.env`):**
      Create a file named `.env` in the `backend/` directory

      Or you can copy `.env.example`

      ```bash
      cp .env.example .env
      ```

      This file holds the configuration for the backend server and database connections. Populate it with the following variables, adjusting values as needed:

      ```dotenv
      # Server Configuration
      SERVER_PORT=8080

      # Database Configuration (for backend connection AND Docker)
      DB_HOST=localhost
      DB_PORT=5432
      DB_USER=your_postgres_user
      DB_PASSWORD=your_postgres_password # *** CHOOSE A STRONG PASSWORD ***
      DB_NAME=hubster_db
      DB_SSLMODE=disable # Use 'require' or other modes if needed for production/cloud DBs
      TIME_ZONE=Asia/Bangkok      # Or your preferred timezone, e.g., UTC

      # PgAdmin Configuration (Used by Docker Compose)
      PGADMIN_DEFAULT_EMAIL=admin@example.com
      PGADMIN_DEFAULT_PASSWORD=your_pgadmin_password # *** CHOOSE A STRONG PASSWORD ***

      # JWT Configuration
      JWT_SECRET=your_very_strong_and_secret_jwt_key # *** IMPORTANT: CHANGE THIS FOR SECURITY! ***
      JWT_EXPIRES_IN_MINUTES=60m # e.g., 60m for 60 minutes

      # CORS Configuration
      CORS_ALLOWED_ORIGINS=http://localhost:5173 # Adjust for your frontend URL, use '*' for wide open development (less secure)

      # Google Cloud Storage Configuration (Optional - leave blank to disable image uploads)
      GCS_BUCKET_NAME=your_gcs_bucket_name
      GCS_SERVICE_ACCOUNT_KEY_PATH=./path/to/your/gcs-service-account-key.json # Relative path from backend directory or absolute path
      ```

      **Important Notes:**

      - **`JWT_SECRET`:** Replace the example value with a strong, unique secret. **Do not commit your actual secret.**
      - **Passwords:** Use strong, unique passwords for `DB_PASSWORD` and `PGADMIN_DEFAULT_PASSWORD`.
      - **`DB_HOST`:** Use `db` if you run the Go backend _outside_ Docker but want it to connect to the PostgreSQL _inside_ Docker. Use `localhost` if you plan to run PostgreSQL natively (not via the included Docker Compose).
      - **GCS:** Fill `GCS_BUCKET_NAME` and `GCS_SERVICE_ACCOUNT_KEY_PATH` to use the image upload feature. Ensure the key file exists at the specified path relative to the `backend` directory.

    - **Install Go Dependencies:**
      ```bash
      go mod download
      ```
    - **Generate/Update API Documentation (Swaggo):**
      Run this command whenever you change the API endpoint comments in your handlers or main file:
      ```bash
      swag init -g cmd/main.go
      ```
      This generates/updates the files in the `backend/docs/` directory.
    - **Run the Backend Server:**

      - **Option 1: Standard Run**
        ```bash
        go run cmd/main.go
        ```
      - **Option 2: Live Reloading with Air (Recommended for Development)**
        Ensure you have `air` installed (`go install github.com/cosmtrek/air@latest`). Then run:
        ```bash
        air
        ```
        Air will watch your Go files and automatically rebuild and restart the server when changes are detected. Configuration for Air might be in an `.air.toml` file (if you have one).

      The backend server will start, typically listening on `http://localhost:8080` (or the `SERVER_PORT` specified in `.env`).

3.  **Database Setup (using Docker Compose):**

    - Make sure you have Docker and Docker Compose installed.
    - Ensure the `.env` file created in the _Backend Setup_ step exists in the `backend/` directory, as Docker Compose will read database credentials from it.
    - Navigate back to the **project root directory** (e.g., `Hubster`).
    - Start the database and PgAdmin containers:

      ```bash
      docker-compose up -d
      ```

      This command builds and starts the PostgreSQL and PgAdmin services defined in `docker-compose.yml` in detached mode (`-d`).

      if you prefer to separate start only PostgreSQL database

      ```bash
      docker-compose up -d db
      ```

      Or Start only PgAdmin

      ```bash
      docker-compose up -d pgadmin
      ```

      if you want to stop you can do

      ```bash
      docker-compose stop
      ```

      Or compose down

      ```bash
      docker-compose down
      ```

      - **PostgreSQL:** Accessible on the host machine at the port specified by `DB_PORT` in `.env` (default: `5432`). The Go backend (running either inside or outside Docker) will connect using the hostname `db` (as defined in `docker-compose.yml` and the default `DB_HOST` in `.env`).
      - **PgAdmin:** Accessible in your browser at `http://localhost:5050`. Log in using the `PGADMIN_DEFAULT_EMAIL` and `PGADMIN_DEFAULT_PASSWORD` from your `.env` file. You can then add a server connection within PgAdmin to manage the database:
        - Host name/address: `db`
        - Port: `5432`
        - Maintenance database: `hubster_db` (or your `DB_NAME`)
        - Username: `postgres` (or your `DB_USER`)
        - Password: Your `DB_PASSWORD`

4.  **Flutter Frontend Setup (`hubster_app/`):**

    - Navigate to the Flutter app directory:
      ```bash
      cd ../hubster_app  # From backend/ or from root: cd hubster_app
      ```
    - **Create Environment File (`.env`):**
      Create a file named `.env` in the `hubster_app/` directory.
      This file is used by `flutter_dotenv` to load environment variables into the Flutter app.

      Or you can copy `.env.example`

      ```bash
      cp .env.example .env
      ```

      ```dotenv
      # Frontend Environment Variables
      # Copy this file to .env and set the correct values

      # Base URL for Go backend API (including the /api path prefix)
      API_BASE_URL=http://localhost:8080/api
      ```

    - **Install Flutter Dependencies:**
      ```bash
      flutter pub get
      ```
    - **Run Code Generation (for `injectable`):**
      Whenever you add or change injectable services:
      ```bash
      flutter pub run build_runner build --delete-conflicting-outputs
      ```
    - **Run the Flutter App:**
      - Select a device/emulator.
      - Run from your IDE or use the command:
        ```bash
        flutter run
        ```
      - If running on a physical device and the backend is on `localhost`, ensure your device can reach your machine's IP address and update `API_BASE_URL` in Flutter's `.env` accordingly.
